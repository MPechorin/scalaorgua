<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Functional programming with arrows</title>
    <link rel="stylesheet" href="../../css/reveal.css">
    <link rel="stylesheet" href="../../css/theme2.css">
    <link rel="stylesheet" href="../../css/code2.css">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
  </head>
<body>
  <div class="reveal">
    <div class="slides">

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <div style="height:600px;"><div style="padding:200px 0px 0px 0px;">
        <h2>Functional programming with arrows</h2>
        <p>
          by&nbsp;
          <a href="http://linkedin.com/in/polyulya" class="roll"><span data-title="Yuriy Polyulya">Yuriy Polyulya</span></a>
          &nbsp;@
          <a href="http://workday.github.io/" class="roll"><span data-title="Workday">Workday</span></a>
        </p>
        </div></div>
      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Baseline & Goals:</h3>
        <section>
          <p style="font-size:50%;text-align:left;">The most imaportant ideas in modern functional programming are:</p>
          <ul style="list-style-type:decimal;font-size:150%;width:100%;padding-bottom:100px;">
            <li class="fragment roll-in" style="padding-top:50px;" data-fragment-index="0">
              It's all about data
              <p style="font-size:33%;text-align:left;margin-top:10px;">functional programming is all about putting data first.
              The firts is defining what kinds of data we have in a problem domain, and what kinds of transformations we want on them.
              Then we building up the data structures and the code to do the transformations.</>
            </li>
            <li class="fragment roll-in" style="padding-top:50px;" data-fragment-index="1">
              Managing of side-effect
              <p style="font-size:33%;text-align:left;margin-top:10px;">functional programming is not about pure functions any more. Eventually, programs will produce side-effects and side-effect management is a puzzle with many parts.</p>
            </li>
          </ul>
        </section>
        <section>
          <div style="height:600px;"><div style="padding:200px 0px 0px 0px;">
          <p style="color:#703D5B;font-size:150%;font-family:'Lobster', sans-serif;">"to show one of technics of managing your data &amp; control side-effect"</p>
          </div></div>
        </section>
        <section>
          <ul style="list-style-type:decimal;font-size:100%;width:100%;padding-top:40px;line-height:2;">
            <li>Function and Combinators</li>
            <li>Arrows and Product</li>
            <li>Arrows and Co-Product</li>
            <li>Arrows and Applicatives</li>
            <li>Arrows and Monads</li>
            <li>Arrows and Transducers</li>
          </ul>
        </section>
      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Function</h3>
        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">
          <div style="height:150px;">
            <div style="position:absolute;margin-left:50px;"><img src="assets/A1.png" alt="url" title=""></div>
            <div class="fragment current-visible" data-fragment-index="2" style="position:absolute;margin-left:50px;"><img src="assets/A2.png" alt="url" title=""></div>
            <div class="fragment current-visible" data-fragment-index="3" style="position:absolute;margin-left:50px;"><img src="assets/A3.png" alt="url" title=""></div>
            <div class="fragment current-visible" data-fragment-index="4" style="position:absolute;margin-left:50px;"><img src="assets/A4.png" alt="url" title=""></div>
          </div>

          <style>
            .nav li {display:inline;}
          </style>
          <div class="nav">
            <ul style="font-size:75%;font-weight:bold;">
              <li class="fragment roll-in" data-fragment-index="1">2 <mark class="green">Objects</mark> ("Hello" &amp; 5) </li>
              <li class="fragment roll-in" data-fragment-index="2"> with <mark class="green">Types</mark> (String &amp; Int)</li>
              <li class="fragment roll-in" data-fragment-index="3"> and <mark class="green">Relation</mark> (String => Int)</li>
            </ul>
          </div>
          </br>

          <div class="fragment current-visible">
          <p style="font-size:75%;text-align:left;font-family:'Lobster', sans-serif;">Abstraction:</p>
          <img src="assets/F1.png" alt="url" title="">
          </div>

          <div class="fragment current-visible">
          <p style="font-size:75%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Int = str => str.length

f("Hello") shouldEqual 5
f("By!")   shouldEqual 3
          </code></pre>
          </div>

        </div></section>

        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">

          <p style="font-size:75%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>
          <img src="assets/F2.png" alt="url" title="">

          <div class="fragment current-visible">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Int = str => str.length
val g: Int => Int    = i => i * 2

val h = g compose h  //  f >>> h

h("Hello")   shouldEqual 10
h("Workday") shouldEqual 14
          </code></pre>
          </div>

        </div></section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Combinators</h3>

          <div style="height:400px;width:85%;"><div style="padding:150px 0px 0px 0px;">
              <p style="font-size:90%;">“a function which builds program fragments from program fragments; in a sense the programmer using combinators constructs much of the desired program automatically, rather than writing every detail by hand”</p>
          </div></div>
          <p style="font-size:50%;text-align:right;">- John Hughes Generalising Monads to Arrows</p>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrows with Product</h3>
        <p style="font-size:50%;text-align:left;">the structure of a product type is determined by the fixed order of the operands in the product.</br>
        The product of type<sub>1</sub>, ..., type<sub>n</sub> is written type<sub>1</sub> * ... * type<sub>n</sub> in ML and <b>(type<sub>1</sub>,...,type<sub>n</sub>)</b>.</p>

        <section>
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>
          <div  style="padding-left:100px;">
            <div style="position:absolute;margin-left:50px;"><img src="assets/P12.png" alt="url" title=""></div>
            <div class="fragment current-visible" data-fragment-index="2" style="position:absolute;margin-left:50px;"><img src="assets/P11.png" alt="url" title=""></div>
          </div>
        </section>

        <section>
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>

          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
// Tuple2[A, B] - scala implementation of product type
def fst[A,B]: ((A,B)) => A = prod => prod._1  // _1 - scala impl of fst
def snd[A,B]: ((A,B)) => B = prod => prod._2  // _2 - scala impl of snd

def delta[A, B, C]: (C => A) => (C => B) => (C => (A,B)) =
  f => g => x => (f(x), g(x))


val f: String => Int    = str => str.length
val g: String => String = str => str.toUpperCase
val h = delta(f)(g)

forAll { (any: String) =>
  (h andThen fst)(any) == f(any) &&
  (h andThen snd)(any) == g(any)
}
          </code></pre>
        </section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Function and Combinators (Part 2)</h3>

        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>
          <img src="assets/F3.png" alt="url" title="">

          <div class="fragment current-visible">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Int    = str => str.length
val g: String => String = str => str.toUpperCase

val h = f &&& g

h("Hello")   shouldEqual (5, "HELLO")
h("Workday") shouldEqual (7, "WORKDAY")
          </code></pre>
          </div>
        </div></section>

        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Arrow Type-Class:</p>
          <p style="font-size:50%;text-align:left;">An arrow is the term used in category theory as an abstract notion of thing that behaves like a function.</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
trait Arrow[~>[_, _]] extends Category[~>] {

  def arr[B, C](f: B => C): B ~> C

  def first[B, C, D](f: B ~> C): (B, D) ~> (C, D)
  def second[A, B, C](f: A ~> B): (C, A) ~> (C, B)

  def &&&[B, C, C2](fbc: B ~> C, fbc2: B ~> C2): B ~> (C, C2)
  def ***[B, C, B2, C2](fbc: B ~> C, fbc2: B2 ~> C2): (B, B2) ~> (C, C2)
}
          </code></pre>
          <div class="fragment current-visible">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">And Category Type-Class:</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
trait Category[~>[_, _]] {

  def id[A]: A ~> A
  def compose[A, B, C](f: B ~> C, g: A ~> B): A ~> C  // >>>
}
          </code></pre>
          </div>
        </div></section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Function and Combinators (Part 2)</h3>

        <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>
        <img src="assets/F4.png" alt="url" title="">

        <div class="fragment current-visible">
        <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>
        <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Int    = str => str.length
val g: String => String = str => str.toUpperCase

val h = f *** g

h("Hello", "Workday") shouldEqual (5, "WORKDAY")
        </code></pre>
        </div>
      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrows with CoProduct</h3>
        <p style="font-size:50%;text-align:left;">very similar to the Either data type; the only difference is that it does not combine two base types, but two type constructors.</p>

        <section>
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>

          <div  style="padding-left:100px;">
            <div style="position:absolute;margin-left:50px;"><img src="assets/P22.png" alt="url" title=""></div>
            <div class="fragment current-visible" data-fragment-index="2" style="position:absolute;margin-left:50px;"><img src="assets/P21.png" alt="url" title=""></div>
          </div>
        </section>

        <section>
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>

          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
// Either[A, B] - scala implementation of co-product type
def left[A,B]: A => Either[A,B]  = a => Left(a)
def right[A,B]: B => Either[A,B] = b => Right(b)

def delta[A, B, C]: (A => C) => (B => C) => (Either[A, B] => C) =
  f => g => x => x match {
    case Left(a)  => f(a)
    case Right(b) => g(b)
  }

val f: Int    => String = i   => i.toString
val g: String => String = str => str * 2
val h = delta(f)(g)

forAll { (anyStr: String, anyInt: Int) =>
  (left andThen h)(anyInt) == f(anyInt) &&
  (right andThen h)(anyStr) == g(anyStr)
}
          </code></pre>
        </section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Function and Combinators (Part 3)</h3>

        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>
          <img src="assets/F5.png" alt="url" title="">

          <div class="fragment current-visible">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Int    = str => str.length
val g: String => String = str => str.toUpperCase

val h = f +++ g

h apply Left[String, String]("Hello")  shouldEqual L[Int, String](5)
h apply Right[String, String]("Hello") shouldEqual R[Int, String]("HELLO")
          </code></pre>
          </div>
        </div></section>

        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">ArrowChoice Type-Class:</p>
          <p style="font-size:50%;text-align:left;">make a choice between two arrows, on the basis of a previous result</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
trait ArrowChoice[~>[_, _]] extends Arrow[~>] {
  type E[A, B] = Either[A, B]

  def left[B, C, D](a: B ~> C): E[B, D] ~> E[C, D]
  def right[B, C, D](a: B ~> C): E[D, B] ~> E[D, C]

  def +++[B, C, B2, C2](a: B ~> C, b: B2 ~> C2): E[B, B2] ~> E[C, C2]
  def |||[B, C, D](a: B ~> D, b: C ~> D): E[B, C] ~> D
}
          </code></pre>
        </div></section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Function and Combinators (Part 3)</h3>

        <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>
        <img src="assets/F6.png" alt="url" title="">

        <div class="fragment current-visible">
        <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>
        <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Int    = str => str.length
val g: String => String = str => str.toUpperCase

val h = f ||| g

h apply Left[String, String]("Hello")  shouldEqual 5
h apply Right[String, String]("Hello") shouldEqual "HELLO"
        </code></pre>
        </div>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Function and Combinators (Part 4)</h3>

        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Definition:</p>
          <img src="assets/F7.png" alt="url" title="">

          <div class="fragment current-visible">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">Code:</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;font-size:90%;line-height:100%;">
val factorial: (Int => Int) => (Int => Int) =
  tail => {
    case 0 => 1
    case x => x * tail(x - 1)
  }

val f: (Int, Int => Int) => (Int, Int => Int) = {
  case (a, loop) => (
    loop(a),           // entry point
    factorial(f)       // loop body
  )
}

arr.loop(f)(5) shouldEqual 120
          </code></pre>
          </div>
        </div></section>

        <section><div style="height:600px;"><div style="padding:0px 0px 0px 0px;">
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">ArrowLoop Type-Class should look:</p>
          <p style="font-size:50%;text-align:left;">arrow class with a feedback combinator</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
trait ArrowLoop extends Arrow[~>] {
  def loop[A, B, C](f: (A, C) ~> (B, C)): A ~> B
}
          </code></pre>

          <div class="fragment roll-in" data-fragment-index="1" style="font-size:50%;">
            <mark style="text-transform:uppercase;" class="red"><b>it does not work</b></mark>
            <p>no easy way to define lazy parameters in lambdas</p>
          </div>

          <div class="fragment roll-in" data-fragment-index="2">
          </br>
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">ArrowLoop Type-Class worked implementation:</p>
          <p style="font-size:50%;text-align:left;">LazyTuple2 from Scalaz lib (:&amp;: - type notation)</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
trait ArrowLoop extends Arrow[~>] {
  import scalaz._
  import scalaz.Scalaz._

  def loop[A, B, C](f: (A :&: C) ~> (B :&: C)): A ~> C =
    b => new { val ac: (A :&: C) = f(lazyTuple(a, ac._2)) }.ac._1
}
          </code></pre>
          </div>
        </div></section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrows</h3>

          <div style="height:600px;"><div style="padding:150px 0px 0px 0px;">
              <p style="font-size:100%;">Arrow is generalization of function, what provide more function combinators:</br>Like first/second/split/combine, ...</p>
          </div></div>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrows</h3>

        <div style="position:absolute;margin-left:50px;"><img src="assets/FP1.png" alt="url" title=""></div>
        <div class="fragment current-visible" data-fragment-index="2" style="position:absolute;margin-left:50px;"><img src="assets/FP2.png" alt="url" title=""></div>
        <div class="fragment current-visible" data-fragment-index="3" style="position:absolute;margin-left:50px;"><img src="assets/FP4.png" alt="url" title=""></div>
        <div class="fragment current-visible" data-fragment-index="4" style="position:absolute;margin-left:50px;"><img src="assets/FP5.png" alt="url" title=""></div>

      </section>


<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Kleisli &amp; Co-Kleisli Arrow</h3>

        <section>
        <img src="assets/C1.png" alt="url" title="">
        <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Int = str => str.length

f("Hello")              shouldEqual 5
Option("Hello").map(f)  shouldEqual Option(5)
        </code></pre>
        </section>

        <section>
        <img src="assets/C2.png" alt="url" title="">
        <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: String => Option[Int] = str =>
  if(str.length <6) None
  else Option(str.length)

f("Hello")    shouldEqual None
f("Workday")  shouldEqual Option(7)
        </code></pre>
        </section>

        <section>
        <img src="assets/C3.png" alt="url" title="">
        <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
val f: Option[String] => Int = str =>
  str.map(_.toUpperCase).getOrElse("")

f(Option("Hello"))  shouldEqual "HELLO"
f(None)             shouldEqual ""
        </code></pre>
        </section>
        <section>
          <p style="font-size:100%;text-align:left;font-family:'Lobster', sans-serif;">KleisliArrow Type-Class:</p>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
type Kleisli[M[+_],A,B] = A => M[A]

trait KleisliCategory[M[+ _]]
  extends Category[({type λ[α, β] = Kleisli[M, α, β]})#λ] {
// ...
}

trait KleisliArrow[M[+_]]
  extends Arrow[({type λ[α, β] = Kleisli[M, α, β]})#λ]
  with KleisliCategory[M] {

// ...
}
          </code></pre>
        </section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrows & Applicatives</h3>
        <section>
          <h4 style="text-align:left;"></h4>
          <pre><code data-trim class="scala" style="max-height:100%;height:100%;">
trait Applicative[M[_]] extends Functor[M] {
  def <*>[A,B](m: M[A], f: M[A => B]): M[B]
}
          </code></pre>
        </section>

        <section>
          <h4 style="text-align:left;">Arrow = Category + Applicative?</h4>
        </section>

      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrows & Monads</h3>
        <section>
          <h4 style="text-align:left;"></h4>
        </section>
        <section>
          <h4 style="text-align:left;">Kleisli & CoKleisli Arrow</h4>
        </section>
        <section>
          <h4 style="text-align:left;">Generalising monads to arrows</h4>
        </section>
        <section>
          <h4 style="text-align:left;">What can Arrows do that Monads can't?</h4>
        </section>
        <section>
          <h4 style="text-align:left;">Arrows for Errors: extending the error (Try) monad</h4>
        </section>
      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrow based stream transducers</h3>
      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Arrows in Domain Modeling (Kleisli Arrow)</h3>
      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <h3 style="text-align:left;">Summary</h3>
      </section>

<!-- ------------------------------------------------------------------------------------- -->
      <section>
        <div style="height:600px;"><div style="padding:200px 0px 0px 0px;">
        <ul style="width:100%;list-style-type:none;list-style:none;align:center;text-align:center;">
          <li data-fragment-index="0"><h2>Questions?</h2><br/></li>
          <li class="fragment roll-in" data-fragment-index="1"><h2>Remarks?</h2></li>
        </ul>
        </div></div>
      </section>

    </div>
  </div>

  <script src="../../js/reveal.min.js"></script>
  <script src="../../js/head.min.js"></script>
  <script>
    Reveal.initialize({
      controls: true,
      progress: true,
      rollingLinks: true,
      history: true,
      center: false,
      theme: Reveal.getQueryHash().theme,

      transition: 'linear',
//      transitionSpeed: 'fast',
      backgroundTransition: 'slide',

      dependencies: [
          { src: '../../js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../../js/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: '../../js/zoom.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
     });
  </script>
  <script type="text/javascript" src="../../js/highlight.js"></script>
  <script type="text/javascript" src="../../js/zoom.js"></script>
</body>
</html>
